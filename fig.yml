mongodb:
  image: dockerfile/mongodb
  command: mongod --smallfiles
  volumes:
    - data/mongodb:/data/db

pdp:
  build: components/tresor-pdp
  volumes:
    - data/policies:/opt/jetty-distribution-9.2.6.v20141205/policies

broker:
  build: components/tresor-broker
  volumes:
    - config/tresor-broker/config/mongoid.yml:/root/tresor-broker/config/mongoid.yml
    - config/tresor-broker/config/settings/production.yml:/root/tresor-broker/config/settings/production.yml
    - config/tresor-broker/config/initializers/run_resque_inline.rb:/root/tresor-broker/config/initializers/run_resque_inline.rb
  links:
    - mongodb
    - pdp

proxyhttp:
  build: components/tresor-proxy
  command: -b http://broker:3000 -n 127.0.0.1 --sso --xacml -fpurl https://tresor-dev-fp.snet.tu-berlin.de -hrurl http://tresor.snet.tu-berlin.de/trust -pdpurl http://broker:broker@pdp:8080/pdp -l DEBUG
  links:
    - broker
    - pdp
  ports:
    - "80:80"

proxytls:
  build: components/tresor-proxy
  command: -b http://broker:3000 -n 127.0.0.1 -p 443 --tls --tls_key certificates/wildcard_key.pem --tls_crt certificates/wildcard_cert_combined.pem --sso --xacml -fpurl https://tresor-dev-fp.snet.tu-berlin.de -hrurl http://tresor.snet.tu-berlin.de/trust -pdpurl http://broker:broker@pdp:8080/pdp -l DEBUG
  volumes:
    - config/tresor-proxy/certificates:/root/tresor-proxy/certificates
  links:
    - broker
    - pdp
  ports:
    - "443:443"